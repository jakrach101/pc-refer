<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß Palliative Care</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=TH+Sarabun+New:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß Palliative Care</h1>
      <p class="sub">MVP v1 ‚Äî ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á <span id="saveStatus" class="save-status"></span></p>
    </header>

    <!-- Progress Navigation -->
    <nav class="progress-nav" id="progressNav">
      <div class="progress-steps">
        <button class="step-btn active" data-step="1" type="button">
          <span class="step-number">1</span>
          <span class="step-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</span>
        </button>
        <button class="step-btn" data-step="2" type="button">
          <span class="step-number">2</span>
          <span class="step-label">‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• & ACP</span>
        </button>
        <button class="step-btn" data-step="3" type="button">
          <span class="step-number">3</span>
          <span class="step-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</span>
        </button>
        <button class="step-btn" data-step="4" type="button">
          <span class="step-number">4</span>
          <span class="step-label">‡πÅ‡∏ú‡∏ô‡∏¢‡∏≤ & Tools</span>
        </button>
        <button class="step-btn" data-step="5" type="button">
          <span class="step-number">5</span>
          <span class="step-label">Preview & Export</span>
        </button>
      </div>
    </nav>

    <main>
      <!-- Step 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
      <div class="step-container active" data-step="1">
        <section class="card">
          <h2>‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• & ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h2>
        <div class="grid">
          <label>
            ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á
            <input id="fromFacility" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡πÄ‡∏ö‡∏≤‡πÉ‡∏à ‡∏£‡∏û.‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå" />
          </label>
          <label>
            ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Primary: ‡∏£‡∏û.‡∏™‡∏ï. ‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô)
            <input id="toFacilityPrimary" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô..." />
          </label>
          <label>
            ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Secondary: ‡∏£‡∏û‡∏ä.)
            <input id="toFacilitySecondary" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏û‡∏ä...." />
          </label>
          <label>
            ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (Tertiary: ‡∏£‡∏û‡∏ó./‡∏£‡∏û‡∏®.)
            <input id="toFacilityTertiary" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏û‡∏ó.... / ‡∏£‡∏û‡∏®...." />
          </label>
          <label>
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠
            <input id="refDate" type="date" />
          </label>
        </div>
      </section>

      <section class="card">
        <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>
        <div class="grid">
          <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <input id="pName" aria-label="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢" /></label>
          <label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ) <input id="pAge" type="number" min="0" aria-label="‡∏≠‡∏≤‡∏¢‡∏∏‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ" aria-describedby="age-hint" /></label>
          <label>HN <input id="pHN" aria-label="Hospital Number" /></label>
          <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô <input id="pCID" aria-label="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å" maxlength="17" /></label>
          <label class="span-2">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà <input id="pAddress" aria-label="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢" /></label>
        </div>
        <div>
          <h3 style="margin:12px 0 8px 2px;font-size:16px">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• <span class="muted" style="font-size:13px">(‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å = ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å)</span></h3>
          <div id="caregiversList"></div>
          <button id="addCaregiver" type="button" class="small" style="margin-top:8px">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
        </div>
      </section>
      </div>
      <!-- End Step 1 -->

      <!-- Step 2: ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏• & ACP -->
      <div class="step-container" data-step="2">
      <section class="card">
        <h2>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠</h2>
        <div id="purposeChips" class="chips">
          <label><input type="checkbox" value="‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô"> ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ö‡πâ‡∏≤‡∏ô</label>
          <label><input type="checkbox" value="‡∏î‡∏π‡πÅ‡∏•‡∏õ‡∏£‡∏∞‡∏Ñ‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Ñ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô"> ‡∏î‡∏π‡πÅ‡∏•‡∏õ‡∏£‡∏∞‡∏Ñ‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Ñ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
          <label><input type="checkbox" value="‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô"> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô</label>
          <label><input type="checkbox" value="‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏¢‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï"> ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏¢‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</label>
        </div>
      </section>

      <section class="card">
        <h2>Advance Care Plan (ACP)</h2>
        <div id="acpChips" class="chips">
          <label><input type="checkbox" value="No CPR"> No CPR</label>
          <label><input type="checkbox" value="No ETT"> No ETT</label>
          <label><input type="checkbox" value="Place of death at home"> Place of death at home</label>
          <label><input type="checkbox" value="Off ETT at home"> Off ETT at home</label>
          <label><input type="checkbox" value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à"> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</label>
        </div>
      </section>

      <section class="card">
        <h2>‡∏à‡∏¥‡∏ï‡∏™‡∏±‡∏á‡∏Ñ‡∏°‚Äì‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì</h2>
        <div class="grid">
          <label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢/‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå <input id="informedBy" /></label>
          <label>‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢
            <select id="living">
              <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option>
              <option>‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏≥‡∏û‡∏±‡∏á</option>
              <option>‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</option>
              <option>‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á</option>
            </select>
          </label>
          <label class="span-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏ß‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ <input id="concerns" /></label>
          <label class="span-2">Perception (‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢) <input id="perceptionPatient" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‚Ä¶" /></label>
          <label class="span-2">Perception (‡∏ç‡∏≤‡∏ï‡∏¥) <input id="perceptionFamily" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ç‡∏≤‡∏ï‡∏¥‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‚Ä¶" /></label>
          <label class="span-2">Conspiracy of silence <input id="conspiracy" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏°‡∏µ/‡πÑ‡∏°‡πà‡∏°‡∏µ + ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" /></label>
        </div>
      </section>
      </div>
      <!-- End Step 2 -->

      <!-- Step 3: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå -->
      <div class="step-container" data-step="3">
      <section class="card">
        <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</h2>
        <div class="grid">
          <label class="span-2">Diagnosis <input id="dx" aria-label="‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÇ‡∏£‡∏Ñ" /></label>
          <label>PPS (%) <input id="pps" type="number" min="10" max="100" step="10" aria-label="Palliative Performance Scale ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå" /></label>
          <label>GFR (mL/min/1.73m¬≤) <input id="gfr" type="number" min="0" max="200" step="1" placeholder="eGFR (mL/min/1.73m¬≤)" aria-label="Glomerular Filtration Rate" /></label>
          <label>Hct (%) <input id="hct" type="number" min="0" max="100" aria-label="Hematocrit ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå" /></label>
          <label>Alb (g/dL) <input id="alb" type="number" step="0.1" aria-label="Albumin ‡∏Å‡∏£‡∏±‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏ã‡∏¥‡∏•‡∏¥‡∏ï‡∏£" /></label>
        </div>
        <div class="grid">
          <label>Metastasis</label>
          <div id="metastasisChips" class="chips span-2">
            <label><input type="checkbox" value="Bone"> Bone</label>
            <label><input type="checkbox" value="Brain"> Brain</label>
            <label><input type="checkbox" value="Liver"> Liver</label>
            <label><input type="checkbox" value="Lung"> Lung</label>
            <label><input type="checkbox" value="Lymph nodes"> Lymph nodes</label>
          </div>
          <label>‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</label>
          <div id="treatmentChips" class="chips span-2">
            <label><input type="checkbox" value="Chemo"> Chemo</label>
            <label><input type="checkbox" value="RT"> RT</label>
            <label><input type="checkbox" value="Surgery"> Surgery</label>
            <label><input type="checkbox" value="Targeted therapy"> Targeted</label>
            <label><input type="checkbox" value="Immunotherapy"> Immuno</label>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>Symptoms & Vital signs</h2>
        <div class="grid">
          <label>‡∏õ‡∏ß‡∏î‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì <input id="painSite" aria-label="‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏õ‡∏ß‡∏î" /></label>
          <label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏ß‡∏î (PS) <input id="painScore" type="number" min="0" max="10" aria-label="Pain Score 0-10" /></label>
          <label>Dyspnea score <input id="dyspneaScore" type="number" min="0" max="10" aria-label="Dyspnea Score 0-10" /></label>
          <label>SpO2 (%) <input id="spo2" type="number" min="0" max="100" aria-label="Oxygen Saturation ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå" /></label>
          <label>RR (‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ) <input id="vsRR" type="number" min="0" aria-label="Respiratory Rate ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ" /></label>
          <label>BP (mmHg) <input id="bp" placeholder="‡πÄ‡∏ä‡πà‡∏ô 120/80" aria-label="Blood Pressure" /></label>
          <label>HR (‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ) <input id="hr" type="number" min="0" aria-label="Heart Rate ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ" /></label>
          <label>GCS <input id="gcs" placeholder="‡πÄ‡∏ä‡πà‡∏ô E4V5M6" aria-label="Glasgow Coma Scale" /></label>
          <label>‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏™‡πâ/‡∏≠‡∏≤‡πÄ‡∏à‡∏µ‡∏¢‡∏ô</label>
          <div id="nauseaChips" class="chips span-2">
            <label><input type="radio" name="nausea" value="‡∏°‡∏µ"> ‡∏°‡∏µ</label>
            <label><input type="radio" name="nausea" value="‡πÑ‡∏°‡πà‡∏°‡∏µ"> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
          </div>
          <label class="span-2">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ <input id="others" /></label>
        </div>
      </section>
      </div>
      <!-- End Step 3 -->

      <!-- Step 4: ‡πÅ‡∏ú‡∏ô‡∏¢‡∏≤ & Tools -->
      <div class="step-container" data-step="4">
      <section class="card">
        <h2>‡πÅ‡∏ú‡∏ô‡∏¢‡∏≤ / ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
        <div class="row">
          <label class="muted">Type</label>
          <div id="orderTypeChips" class="chips">
            <label><input type="radio" name="orderType" value="po" checked> PO/SL</label>
            <label><input type="radio" name="orderType" value="inj_prn"> Inject PRN</label>
            <label><input type="radio" name="orderType" value="inf"> Infusion</label>
          </div>
        </div>

        <div id="singleOrder">
          <div class="med-order-form">
            <!-- Main Input Row -->
            <div class="med-input-row">
              <div class="med-field med-field-drug">
                <label class="med-label">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
                <input id="drugName" placeholder="‡πÄ‡∏ä‡πà‡∏ô MST 30 mg/tab" list="formulary" />
              </div>

              <div class="med-field">
                <label class="med-label">
                  ‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ (dose)
                  <span id="doseUnitLabel" class="unit-badge"></span>
                </label>
                <input id="dose" type="number" min="0" step="0.5" placeholder="1" />
              </div>

              <div class="med-field med-field-grow">
                <label class="med-label">‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ</label>
                <input id="freq" placeholder="q12h, bid, tid" list="freqList" />
              </div>

              <div class="med-field med-field-qty">
                <label class="med-label">
                  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                  <span id="qtyPackLabel" class="pack-info"></span>
                </label>
                <div class="qty-input-wrapper">
                  <input id="qty" type="number" min="0" step="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" required />
                  <span class="qty-calc-icon" id="showCalc" title="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô">üßÆ</span>
                </div>
              </div>

              <div class="med-actions">
                <button id="addOne" type="button" class="btn-add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤</button>
                <button id="clearOne" type="button" class="btn-clear">‡∏•‡πâ‡∏≤‡∏á</button>
              </div>
            </div>

            <!-- Calculator Panel (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å üßÆ) -->
            <div id="calcPanel" class="calc-panel hidden">
              <div class="calc-panel-header">
                <span class="calc-panel-title">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏≤</span>
                <button id="closeCalc" class="calc-close">‚úï</button>
              </div>
              <div class="calc-panel-body">
                <div class="calc-row">
                  <input id="calcDoseInput" type="number" min="0" step="0.5" placeholder="Dose" class="calc-input-small" />
                  <span class="calc-separator">√ó</span>
                  <input id="calcFreqInput" placeholder="q12h, tid" class="calc-input-medium" />
                  <span class="calc-separator">√ó</span>
                  <input id="medDuration" type="number" min="1" max="365" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô" class="calc-input-small" />
                  <span class="calc-info">‡∏ß‡∏±‡∏ô</span>
                  <button id="calcMedQty" type="button" class="btn-calc">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
                </div>
                <div id="calcResultRow" class="calc-result-row hidden">
                  <span class="calc-result-text">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: <strong id="calcResultValue">-</strong></span>
                  <button id="applyCalcResult" type="button" class="btn-apply-calc">‚úì ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ</button>
                </div>
              </div>
            </div>
          </div>

          <datalist id="formulary"></datalist>
          <datalist id="freqList"></datalist>
        </div>

        <div id="infusionOrder" class="hidden">
          <div class="row preset-bar">
            <button id="presetCSCI1" type="button">Preset: Morphine (CSCI)</button>
            <button id="presetCSCI2" type="button">Preset: Morphine + Midazolam</button>
            <button id="presetCSCI3" type="button">Preset: Morphine + Midazolam + Hyoscine</button>
          </div>
          <div id="mixRows"></div>
          <datalist id="formularyIvSc"></datalist>
          <div class="row" id="mixBar">
            <select id="mixRoute" title="Route"><option value="CSCI">CSCI</option><option value="IV">IV</option></select>
            <select id="mixDevice" title="Device"></select>
            <input id="mixDiluent" placeholder="Diluent (‡πÄ‡∏ä‡πà‡∏ô NSS)" title="Diluent" />
            <input id="mixFinalVol" type="number" min="1" placeholder="Vol (mL)" title="Final volume" />
            <input id="mixDuration" type="number" min="1" value="24" placeholder="Dur (h)" title="Duration" />
            <span id="mixRateWrap" class="hidden"><input id="mixRate" type="number" min="0" step="0.1" placeholder="mL/h" title="Rate (mL/h)" /></span>
            <span id="mixMmWrap"><input id="mixMmPerHr" type="number" min="0" step="0.1" placeholder="mm/h" title="Set speed (mm/h)" /></span>
            <span id="mixDiaWrap"><input id="mixDia" type="number" min="0" step="0.1" placeholder="√ò mm" title="Syringe diameter (mm)" /></span>
            <input id="mixSite" placeholder="Site" title="Site" />
            <input id="mixQty" type="number" min="1" placeholder="#" title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (bag)" />
          </div>
          <div class="row">
            <button id="mixAdd" class="btn-primary" type="button">Add to Med List</button>
          </div>
        </div>

        <div id="medList"></div>
        <div id="tddSummary" class="sub"></div>
      </section>


      

      <details class="card">
        <summary>Conversion: Oral Morphine ‚Üí Fentanyl patch</summary>
        <div class="grid mt-8">
          <label>Oral Morphine (mg/24h) <input id="oralMorphine24" type="number" min="0" /></label>
          <label>Opioid-na√Øve?
            <select id="isNaiveForPatch">
              <option>No</option>
              <option>Yes</option>
            </select>
          </label>
        </div>
        <div class="row">
          <button id="convSuggest" type="button">Suggest patch</button>
        </div>
        <div id="convResult"></div>
      </details>

      <section class="card">
        <h2>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (Follow-up)</h2>
        <div class="grid">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <input id="fuDate" type="date" /></label>
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° <input id="fuSite" /></label>
          <label>‡πÇ‡∏ó‡∏£ <input id="fuTel" /></label>
        </div>
      </section>

      <section class="card">
        <h2>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
        <div class="grid">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å <input id="recorderName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏û.‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" list="recorderList" /></label>
          <label>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <input id="recorderTel" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678" /></label>
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å <input id="recordDate" type="date" /></label>
        </div>
        <datalist id="recorderList">
          <option value="‡∏û‡∏ß.‡∏ß‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ó‡∏¥‡∏û‡∏¢‡πå">064-9081365</option>
          <option value="‡∏û‡∏ç.‡∏•‡∏•‡∏¥‡∏î‡∏≤"></option>
          <option value="‡∏û‡∏ç.‡∏ô‡∏±‡∏ê‡∏¢‡∏≤"></option>
          <option value="‡∏û‡∏ç.‡∏û‡∏±‡∏ä‡∏ô‡∏∏"></option>
          <option value="‡∏ô‡∏û.‡∏à‡∏±‡∏Å‡∏£‡∏≤‡∏ä"></option>
        </datalist>
      </section>
      </div>
      <!-- End Step 4 -->

      <!-- Step 5: Preview & Export -->
      <div class="step-container" data-step="5">
      <section class="actions-container">
        <h2 class="actions-title">Preview & Export</h2>

        <div class="action-buttons-compact">
          <button id="previewBtn" type="button" class="btn-action btn-primary">
            <span class="btn-icon">üëÅÔ∏è</span>
            <span class="btn-text">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</span>
          </button>
          <button id="exportPdf" type="button" class="btn-action btn-primary">
            <span class="btn-icon">üñ®Ô∏è</span>
            <span class="btn-text">Print PDF</span>
          </button>
          <button id="copyHis" type="button" class="btn-action btn-secondary">
            <span class="btn-icon">üìã</span>
            <span class="btn-text">Copy HIS Note</span>
          </button>
          <button id="exportData" type="button" class="btn-action btn-secondary">
            <span class="btn-icon">üì¶</span>
            <span class="btn-text">Export (.json)</span>
          </button>
          <button id="exportExcel" type="button" class="btn-action btn-secondary">
            <span class="btn-icon">üìä</span>
            <span class="btn-text">Export Excel</span>
          </button>
          <button id="importData" type="button" class="btn-action btn-utility">
            <span class="btn-icon">üì•</span>
            <span class="btn-text">Import</span>
          </button>
          <button id="togglePrintSettings" type="button" class="btn-action btn-utility">
            <span class="btn-icon">‚öôÔ∏è</span>
            <span class="btn-text">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå</span>
          </button>
          <button id="openDrive" type="button" class="btn-action btn-utility">
            <span class="btn-icon">üìÇ</span>
            <span class="btn-text">‡πÄ‡∏õ‡∏¥‡∏î Drive</span>
          </button>
          <button id="clearAll" type="button" class="btn-action btn-danger">
            <span class="btn-icon">üóëÔ∏è</span>
            <span class="btn-text">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <small>(‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö)</small></span>
          </button>
        </div>

        <input id="importFile" type="file" accept="application/json,.json" style="display:none" />
      </section>

      <!-- Print Settings Panel -->
      <section id="printSettingsPanel" class="card print-settings-panel hidden">
        <div class="print-settings-header">
          <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå</h2>
          <button id="closePrintSettings" class="settings-close">‚úï</button>
        </div>

        <div class="print-settings-grid">
          <!-- Typography Settings -->
          <div class="settings-group">
            <h3 class="settings-group-title">üìù ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î</h3>
            <div class="settings-row">
              <label class="settings-label">
                <span>Font Family</span>
                <select id="printFont" class="settings-input">
                  <option>TH SarabunPSK</option>
                  <option>TH Sarabun New</option>
                  <option>Sarabun</option>
                  <option>Noto Sans Thai</option>
                  <option>Tahoma</option>
                  <option>Arial</option>
                  <option>System</option>
                </select>
              </label>

              <label class="settings-label">
                <span>Font Size <span class="settings-value" id="printSizeValue">12pt</span></span>
                <input id="printSize" type="range" min="4" max="20" step="0.5" value="12" class="settings-slider" />
              </label>

              <label class="settings-label">
                <span>Line Height <span class="settings-value" id="printLineHeightValue">1.35</span></span>
                <input id="printLineHeight" type="range" min="1.10" max="1.60" step="0.05" value="1.35" class="settings-slider" />
              </label>
            </div>
          </div>

          <!-- Layout Settings -->
          <div class="settings-group">
            <h3 class="settings-group-title">üìÑ ‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå</h3>
            <div class="settings-row">
              <label class="settings-label">
                <span>Page Width <span class="settings-value" id="printWidthValue">190mm</span></span>
                <input id="printWidth" type="range" min="150" max="200" step="5" value="190" class="settings-slider" />
              </label>

              <label class="settings-toggle">
                <input id="fitOnePage" type="checkbox" />
                <span class="toggle-label">
                  <strong>Fit to 1 Page</strong>
                  <small>‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ 1 ‡∏´‡∏ô‡πâ‡∏≤</small>
                </span>
              </label>

              <label class="settings-toggle">
                <input id="printWordLike" type="checkbox" checked />
                <span class="toggle-label">
                  <strong>Word-like Layout</strong>
                  <small>‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö MS Word</small>
                </span>
              </label>
            </div>
          </div>

          <!-- Footer Settings -->
          <div class="settings-group">
            <h3 class="settings-group-title">üìå ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢</h3>
            <div class="settings-row">
              <label class="settings-toggle">
                <input id="printShowPrinted" type="checkbox" checked />
                <span class="toggle-label">
                  <strong>‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå</strong>
                  <small>Printed on...</small>
                </span>
              </label>

              <label class="settings-toggle">
                <input id="printShowPgn" type="checkbox" />
                <span class="toggle-label">
                  <strong>‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤</strong>
                  <small>Page X of Y</small>
                </span>
              </label>
            </div>
          </div>
        </div>

        <div class="print-settings-footer">
          <button id="resetPrintSettings" type="button" class="btn-reset">‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
          <button id="applyPrintSettings" type="button" class="btn-primary">‚úì ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
      </section>

      <section id="hisBlock" class="card">
        <h2>HIS Note (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</h2>
        <pre id="hisText"></pre>
      </section>

      <!-- PDF Preview Section (unified with print document) -->
      <section id="previewSection" class="card preview-container">
        <div class="preview-header">
          <div class="preview-title">
            <h2>üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</h2>
          </div>
          <div class="preview-controls">
            <button id="zoomOut" type="button" class="zoom-btn" title="‡∏ã‡∏π‡∏°‡∏≠‡∏≠‡∏Å">‚àí</button>
            <span id="zoomLevel" class="zoom-level">100%</span>
            <button id="zoomIn" type="button" class="zoom-btn" title="‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤">+</button>
            <button id="resetZoom" type="button" class="zoom-btn-reset" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ã‡∏π‡∏°">‚ü≤</button>
          </div>
        </div>

        <!-- Empty State -->
        <div id="previewEmptyState" class="preview-empty-state">
          <div class="empty-state-icon">üìÑ</div>
          <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF</h3>
          <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>"‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF"</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
        </div>

        <!-- Loading State -->
        <div id="previewLoadingState" class="preview-loading-state hidden">
          <div class="loading-spinner"></div>
          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF...</p>
        </div>

        <!-- Preview Wrapper -->
        <div id="previewWrapper" class="preview-wrapper hidden">
          <!-- Page Estimate Badge (moved here from header) -->
          <div id="pageEstimate" class="page-estimate-badge"></div>

          <div class="scroll-indicator" id="scrollIndicator">
            <span>‚¨á</span> ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
          </div>
          <div id="printDoc" class="pdf-document">
            <!-- PDF content will be rendered here -->
          </div>
        </div>
      </section>
      </div>
      <!-- End Step 5 -->

      <div id="snack"></div>

      <!-- Confirmation Modal -->
      <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
            <button type="button" class="modal-close" id="modalClose">‚úï</button>
          </div>
          <div class="modal-body">
            <p id="modalMessage">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-modal btn-cancel" id="modalCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button type="button" class="btn-modal btn-confirm" id="modalConfirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
          </div>
        </div>
      </div>
    </main>

    <!-- html2pdf for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="app.js"></script>
    <script src="med-calculator.js"></script>
  </body>
  </html>
